/* ============================================
   TRENDSYNTHESIS — Localization (i18n)
   Professional SaaS Copywriting
   ============================================ */

const translations = {
    ru: {
        nav: {
            how_it_works: "Процесс",
            features: "Возможности",
            demo: "Платформа",
            cta: "НАЧАТЬ"
        },
        hero: {
            badge: "ВЕРСИЯ 2.4 ДОСТУПНА",
            title: "Генерация вирусного контента на автопилоте",
            subtitle: "Превращаем <span class='subtitle-highlight'>один заголовок</span> в 30 уникальных роликов за 5 минут. Нейросеть, которая понимает алгоритмы TikTok и Reels.",
            btn_primary: "Запустить демо",
            btn_secondary: "Документация",
            demo_window: {
                title: "Trendsynthesis_Core_v2.4",
                label_input: "INPUT_SOURCE",
                label_model: "MODEL",
                text_input: "smm-trends-2025.pdf",
                text_model: "Viral_H100_v2"
            }
        },
        problem: {
            tag: "СРАВНЕНИЕ",
            title: "Почему агентства теряют деньги",
            bad: {
                title: "Традиционный процесс",
                list: [
                    "5 человек в команде (копирайтер, монтажер...)",
                    "3-4 дня на производство пачки роликов",
                    "Расходы от $2000/мес на ФОТ",
                    "Нет гарантии виральности"
                ]
            },
            good: {
                title: "Платформа TrendSynthesis",
                list: [
                    "1 оператор (вы)",
                    "5 минут на генерацию 30 роликов",
                    "Стоимость подписки $49/мес",
                    "Алгоритмическая оптимизация под тренды"
                ]
            }
        },
        steps: {
            tag: "WORKFLOW",
            title: "От идеи до публикации",
            step1: {
                title: "01. Входящие данные",
                desc: "Загрузите тему, ссылку на статью или просто ключевое слово. Система проанализирует семантическое ядро."
            },
            step2: {
                title: "02. Генерация",
                desc: "Наши GPU-кластеры создают сценарии, видеоряд и озвучку, синхронизируя всё с трендовой музыкой."
            },
            step3: {
                title: "03. Экспорт",
                desc: "Получите архив с 30 готовыми MP4 файлами, очищенными от метаданных и готовыми к заливу."
            }
        },
        features: {
            tag: "ТЕХНОЛОГИИ",
            title: "Stack возможностей",
            f1: { title: "AI-Vision", desc: "Подбор видеоряда, который удерживает внимание с первых секунд." },
            f2: { title: "Copywriting", desc: "Сценарии на базе вирусных хуков и триггеров психологии." },
            f3: { title: "Voice-Over", desc: "Естественная озвучка на 15 языках с интонациями живого человека." }
        },
        demo_section: {
            tag: "ИНТЕРФЕЙС",
            title: "Панель управления",
            input_label: "ТЕМА ИЛИ НИША",
            input_placeholder: "Например: Недвижимость в Дубае",
            btn_generate: "СГЕНЕРИРОВАТЬ",
            status: {
                parsing: "СЕМАНТИЧЕСКИЙ АНАЛИЗ",
                synthesis: "ВИЗУАЛЬНЫЙ РЕНДЕРИНГ"
            },
            results: {
                title: "ГОТОВО К ВЫГРУЗКЕ",
                views: "Прогноз просмотров",
                retention: "Удержание",
                virality: "Виральность",
                ctr: "CTR"
            },
            action_btn: "ПОЛУЧИТЬ ДОСТУП"
        },
        // Flat keys for Demo Tiles
        demo_style_fear: "СТРАХ",
        demo_style_benefit: "ВЫГОДА",
        demo_style_trend: "ТРЕНД",
        demo_more_videos: "ВИДЕО ГОТОВО",
        demo_action_btn: "ЗАПУСТИТЬ ПОЛНЫЙ ЦИКЛ",

        cta: {
            title: "Масштабируйте контент, а не штат",
            desc: "Идеально для арбитражников, продюсеров и content-менеджеров.",
            btn: "ВСТУПИТЬ В LIST"
        },
        footer: {
            logo: "TRENDSYNTHESIS",
            rights: "ALL SYSTEMS OPERATIONAL"
        },
        modal: {
            title: "Запрос доступа",
            btn: "ОТПРАВИТЬ ЗАЯВКУ"
        }
    },
    en: {
        nav: {
            how_it_works: "Workflow",
            features: "Features",
            good_list: [
                "30 videos = 5 minutes",
                "No contractors needed",
                "Unique visual every time",
                "0% detect - algorithms see original",
                "Automation = consistent posting"
            ]
        },
        steps: {
            tag: "HOW IT WORKS",
            title: "Three steps to content",
            step1_title: "Upload Topic",
            step1_desc: 'Write what you want videos about. Ex: "How AI is killing freelancing"',
            step2_title: "Wait 5 Minutes",
            step2_desc: "System generates 10 angles x 3 styles = 30 unique videos",
            step3_title: "Download & Post",
            step3_desc: "Ready-to-use .mp4 files. Just upload to TikTok, Reels or Shorts"
        },
        features: {
            tag: "FEATURES",
            title: "Why it works",
            desc: "Every video is unique at the code level",
            f1_title: "Algorithm Invisible",
            f1_desc: "Each video is unique. Metadata wiped, hash new, pixels shifted. TikTok sees original content - not stock copies.",
            f2_title: "Speed",
            f2_desc: "30 videos in 5 minutes. While competitors make one - you're already posting.",
            f3_title: "Aesthetics",
            f3_desc: "Videos look like Apple ads - not like Canva templates.",
            f4_title: "10 Angles",
            f4_desc: "One topic covered from 10 different perspectives. Reach different audiences.",
            f5_title: "3 Styles",
            f5_desc: "Each angle in three visual styles. Aggressive, Aesthetic, Abstract."
        },
        demo_section: {
            tag: "DEMO",
            title: "See how it looks",
            input_label: "Input:",
            input_value: '"Death of SMM agencies: why business needs no middlemen"',
            time: "5 minutes",
            style_fear: "Fear",
            style_benefit: "Benefit",
            style_trend: "Trend",
            angle_aggressive: "Aggressive Style",
            angle_aesthetic: "Aesthetic Style",
            angle_abstract: "Abstract Style",
            more_videos: "More videos",
            btn_generate: "GENERATE",
            final_text: "System is ready for your topic.",
            final_btn: "START FULL CYCLE"
        },
        cta: {
            tag: "START NOW",
            title: "Your first run is free",
            desc: "One video is an experiment. Thirty is a strategy. Try the system and see the results.",
            price_label: "first run",
            features: [
                "✓ 30 unique videos",
                "✓ All 10 angles and 3 styles",
                "✓ Download in .mp4",
                "✓ No watermarks"
            ],
            btn: "CREATE 30 VIDEOS FREE",
            note: "No card. No subscription. Just try it."
        },
        footer: {
            copy: "Content Independence"
        },
        modal: {
            title: "Early Access",
            subtitle: "System is in private beta. Leave email to get an invite.",
            btn: "GET AN INVITE",
            note: "Spots available: 50/500"
        }
    }
};

document.addEventListener('DOMContentLoaded', () => {
    const langOptions = document.querySelectorAll('.lang-opt');
    const elementsToTranslate = document.querySelectorAll('[data-i18n]');
    const listElementsTranslate = document.querySelectorAll('[data-i18n-list]');

    // Default language is RU
    let currentLang = 'en';

    function updateContent() {
        // Update simple text elements
        elementsToTranslate.forEach(el => {
            const key = el.getAttribute('data-i18n');
            const parts = key.split('_');

            // Handle nested keys logic (simplified for our structure)
            // Convention: section_key -> translations[lang][section][key]
            let value;

            // 1. Check for flat key (priority)
            if (translations[currentLang][key]) {
                value = translations[currentLang][key];
            }
            // 2. Check for nested sections
            else if (key.includes('nav_')) {
                value = translations[currentLang].nav[key.replace('nav_', '')];
            } else if (key.includes('hero_')) {
                value = translations[currentLang].hero[key.replace('hero_', '')];
            } else if (key.includes('demo_preview_')) {
                value = translations[currentLang].demo_preview[key.replace('demo_preview_', '')];
            } else if (key.includes('problem_')) {
                // Special case for lists handled separately
                if (!key.includes('list')) {
                    value = translations[currentLang].problem[key.replace('problem_', '')];
                }
            } else if (key.includes('steps_')) {
                value = translations[currentLang].steps[key.replace('steps_', '')];
            } else if (key.includes('features_')) {
                value = translations[currentLang].features[key.replace('features_', '')];
            } else if (key.includes('demo_section_')) {
                value = translations[currentLang].demo_section[key.replace('demo_section_', '')];
            } else if (key.includes('cta_')) {
                if (!key.includes('features')) {
                    value = translations[currentLang].cta[key.replace('cta_', '')];
                }
            } else if (key.includes('footer_')) {
                value = translations[currentLang].footer[key.replace('footer_', '')];
            } else if (key.includes('modal_')) {
                value = translations[currentLang].modal[key.replace('modal_', '')];
            } else if (key.includes('demo_btn_')) {
                // Special case for demo button
                value = translations[currentLang].demo_section[key.replace('demo_btn_', 'btn_')];
            } else if (key.includes('demo_final_')) {
                value = translations[currentLang].demo_section[key.replace('demo_final_', 'final_')];
            }

            if (value) {
                // If it's a button with icon, we need to preserve icon
                if (el.querySelector('.btn-icon') || el.querySelector('.btn-arrow')) {
                    const icon = el.querySelector('.btn-icon') || el.querySelector('.btn-arrow');
                    el.childNodes.forEach(node => {
                        if (node.nodeType === 3 && node.textContent.trim() !== '') {
                            node.textContent = ` ${value} `; // Add spaces for padding
                        }
                    });
                    // If text node not found/empty (weird case), just append? No, let's keep it simple.
                    // Simpler approach for buttons:
                    // 1. Get icon HTML
                    // 2. Set innerHTML = icon + text (or text + icon)
                    if (el.classList.contains('btn-secondary')) {
                        // Text then arrow
                        el.innerHTML = `${value} <span class="btn-arrow">→</span>`;
                    } else {
                        // Icon then text
                        const iconHtml = icon.outerHTML;
                        el.innerHTML = `${iconHtml} ${value}`;
                    }
                } else if (el.querySelector('.subtitle-highlight')) {
                    // Special handling for hero subtitle which has a span inside
                    // We replace the text content of the parent but keep the span structure?
                    // Actually, in our object 'subtitle' is the first part, 'subtitle_highlight' is the span part.
                    // But in HTML structure, p contains text + span.
                    // Easier to just use data-i18n on the p for the first part and data-i18n on the span for second.
                    // Let's adjust HTML structure to be compatible.
                    el.textContent = value;
                } else {
                    el.textContent = value;
                }
            }
        });

        // Update lists
        listElementsTranslate.forEach(el => {
            const key = el.getAttribute('data-i18n-list');
            let listArr;
            if (key === 'problem_bad_list') listArr = translations[currentLang].problem.bad_list;
            if (key === 'problem_good_list') listArr = translations[currentLang].problem.good_list;
            if (key === 'cta_features') listArr = translations[currentLang].cta.features;

            if (listArr) {
                el.innerHTML = listArr.map(item => `<li>${item}</li>`).join('');
            }
        });

        // Update active class on switch
        langOptions.forEach(opt => {
            if (opt.getAttribute('data-lang') === currentLang) {
                opt.classList.add('active');
            } else {
                opt.classList.remove('active');
            }
        });
    }

    langOptions.forEach(opt => {
        opt.addEventListener('click', () => {
            currentLang = opt.getAttribute('data-lang');
            updateContent();
        });
    });
});
